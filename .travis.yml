dist: xenial

language: go

go:
  - 1.11.x
  - 1.12.x

env:
  global:
    - GO111MODULE=on
    - GOFLAGS="-mod=readonly"

install:
  - make dependencies

script:
  - make test-coverage
  # make codecov
  # uncomment when source{d} has more private repository credits at codecov.io

stages:
  - style
  - test
  - name: deploy
    # require any tag name
    if: tag =~ .*

matrix:
  fast_finish: true
  include:
    - stage: style
      go: 1.12.x
      install:
        - make install-dev-deps
      script:
        - make check-style
    - stage: deploy
      go: 1.12.x
      install: skip
      script:
        - make packages
      deploy:
        provider: releases
        file_glob: true
        api_key:
          secure: $GITHUB_TOKEN
        file: build/*.tar.gz
        skip_cleanup: true
        on:
          tags: true

notifications:
  email: false
